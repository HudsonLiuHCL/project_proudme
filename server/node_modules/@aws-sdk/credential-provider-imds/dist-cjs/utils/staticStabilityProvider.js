"use strict";
Object.defineProperty(exports, "__esModule", { value: true ***REMOVED***
exports.staticStabilityProvider = void 0;
const getExtendedInstanceMetadataCredentials_1 = require("./getExtendedInstanceMetadataCredentials");
const staticStabilityProvider = (provider, options = {}) => {
    const logger = (options === null || options === void 0 ? void 0 : options.logger) || console;
    let pastCredentials;
    return async () => {
        let credentials;
      ***REMOVED***
            credentials = await provider();
            if (credentials.expiration && credentials.expiration.getTime() < Date.now()) {
                credentials = (0, getExtendedInstanceMetadataCredentials_1.getExtendedInstanceMetadataCredentials)(credentials, logger);
        ***REMOVED***
    ***REMOVED***
        catch (e) {
            if (pastCredentials) {
                logger.warn("Credential renew failed: ", e);
                credentials = (0, getExtendedInstanceMetadataCredentials_1.getExtendedInstanceMetadataCredentials)(pastCredentials, logger);
        ***REMOVED***
            else {
                throw e;
        ***REMOVED***
    ***REMOVED***
        pastCredentials = credentials;
        return credentials;
***REMOVED***;
};
exports.staticStabilityProvider = staticStabilityProvider;
