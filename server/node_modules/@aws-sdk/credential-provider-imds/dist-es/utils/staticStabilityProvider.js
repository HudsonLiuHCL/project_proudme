import { getExtendedInstanceMetadataCredentials } from "./getExtendedInstanceMetadataCredentials";
export const staticStabilityProvider = (provider, options = {}) => {
    const logger = options?.logger || console;
    let pastCredentials;
    return async () => {
        let credentials;
      ***REMOVED***
            credentials = await provider();
            if (credentials.expiration && credentials.expiration.getTime() < Date.now()) {
                credentials = getExtendedInstanceMetadataCredentials(credentials, logger);
        ***REMOVED***
    ***REMOVED***
        catch (e) {
            if (pastCredentials) {
                logger.warn("Credential renew failed: ", e);
                credentials = getExtendedInstanceMetadataCredentials(pastCredentials, logger);
        ***REMOVED***
            else {
                throw e;
        ***REMOVED***
    ***REMOVED***
        pastCredentials = credentials;
        return credentials;
***REMOVED***;
};
