"use strict";
Object.defineProperty(exports, "__esModule", { value: true ***REMOVED***
exports.resolveProcessCredentials = void 0;
const property_provider_1 = require("@aws-sdk/property-provider");
const child_process_1 = require("child_process");
const util_1 = require("util");
const getValidatedProcessCredentials_1 = require("./getValidatedProcessCredentials");
const resolveProcessCredentials = async (profileName, profiles) => {
    const profile = profiles[profileName];
    if (profiles[profileName]) {
        const credentialProcess = profile["credential_process"];
        if (credentialProcess !== undefined) {
            const execPromise = (0, util_1.promisify)(child_process_1.exec);
          ***REMOVED***
                const { stdout } = await execPromise(credentialProcess);
                let data;
              ***REMOVED***
                    data = JSON.parse(stdout.trim());
            ***REMOVED***
                catch (_a) {
                    throw Error(`Profile ${profileName} credential_process returned invalid JSON.`);
            ***REMOVED***
                return (0, getValidatedProcessCredentials_1.getValidatedProcessCredentials)(profileName, data);
        ***REMOVED***
            catch (error) {
                throw new property_provider_1.CredentialsProviderError(error.message);
        ***REMOVED***
    ***REMOVED***
        else {
            throw new property_provider_1.CredentialsProviderError(`Profile ${profileName} did not contain credential_process.`);
    ***REMOVED***
***REMOVED***
    else {
        throw new property_provider_1.CredentialsProviderError(`Profile ${profileName} could not be found in shared credentials file.`);
***REMOVED***
};
exports.resolveProcessCredentials = resolveProcessCredentials;
