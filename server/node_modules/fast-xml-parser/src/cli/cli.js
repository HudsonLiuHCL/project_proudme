#!/usr/bin/env node
'use strict';
/*eslint-disable no-console*/
const fs = require('fs');
const path = require('path');
const {XMLParser, XMLValidator} = require("../fxp");
const readToEnd = require('./read').readToEnd;

const version = require('./../../package.json').version;
if (process.argv[2] === '--help' || process.argv[2] === '-h') {
  console.log(require("./man"));
} else if (process.argv[2] === '--version') {
  console.log(version);
} else {
  const options = {
    removeNSPrefix: true,
    ignoreAttributes: false,
    parseTagValue: true,
    parseAttributeValue: true,
***REMOVED***;
  let fileName = '';
  let outputFileName;
  let validate = false;
  let validateOnly = false;
  for (let i = 2; i < process.argv.length; i++) {
    if (process.argv[i] === '-ns') {
      options.removeNSPrefix = false;
***REMOVED*** else if (process.argv[i] === '-a') {
      options.ignoreAttributes = true;
***REMOVED*** else if (process.argv[i] === '-c') {
      options.parseTagValue = false;
      options.parseAttributeValue = false;
***REMOVED*** else if (process.argv[i] === '-o') {
      outputFileName = process.argv[++i];
***REMOVED*** else if (process.argv[i] === '-v') {
      validate = true;
***REMOVED*** else if (process.argv[i] === '-V') {
      validateOnly = true;
***REMOVED***
      //filename
      fileName = process.argv[i];
***REMOVED***
***REMOVED***
  
  const callback = function(xmlData) {
    let output = '';
    if (validate) {
      const parser = new XMLParser(options);
      output = parser.parse(xmlData,validate);
***REMOVED*** else if (validateOnly) {
      output = XMLValidator.validate(xmlData);
      process.exitCode = output === true ? 0 : 1;
***REMOVED***
      const parser = new XMLParser(options);
      output = JSON.stringify(parser.parse(xmlData,validate), null, 4);
***REMOVED***
    if (outputFileName) {
      writeToFile(outputFileName, output);
***REMOVED***
      console.log(output);
***REMOVED***
***REMOVED***;

***REMOVED***
    
    if (!fileName) {
      readToEnd(process.stdin, function(err, data) {
        if (err) {
          throw err;
    ***REMOVED***
        callback(data.toString());
      ***REMOVED***
***REMOVED***
      fs.readFile(fileName, function(err, data) {
        if (err) {
          throw err;
    ***REMOVED***
        callback(data.toString());
      ***REMOVED***
***REMOVED***
***REMOVED*** catch (e) {
    console.log('Seems an invalid file or stream.' + e);
***REMOVED***
}

function writeToFile(fileName, data) {
  fs.writeFile(fileName, data, function(err) {
    if (err) {
      throw err;
***REMOVED***
    console.log('JSON output has been written to ' + fileName);
  ***REMOVED***
}
