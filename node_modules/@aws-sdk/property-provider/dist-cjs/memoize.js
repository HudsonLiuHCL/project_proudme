"use strict";
Object.defineProperty(exports, "__esModule", { value: true ***REMOVED***
exports.memoize = void 0;
const memoize = (provider, isExpired, requiresRefresh) => {
    let resolved;
    let pending;
    let hasResult;
    let isConstant = false;
    const coalesceProvider = async () => {
        if (!pending) {
            pending = provider();
    ***REMOVED***
      ***REMOVED***
            resolved = await pending;
            hasResult = true;
            isConstant = false;
    ***REMOVED***
        finally {
            pending = undefined;
    ***REMOVED***
        return resolved;
***REMOVED***;
    if (isExpired === undefined) {
        return async (options) => {
            if (!hasResult || (options === null || options === void 0 ? void 0 : options.forceRefresh)) {
                resolved = await coalesceProvider();
        ***REMOVED***
            return resolved;
    ***REMOVED***;
***REMOVED***
    return async (options) => {
        if (!hasResult || (options === null || options === void 0 ? void 0 : options.forceRefresh)) {
            resolved = await coalesceProvider();
    ***REMOVED***
        if (isConstant) {
            return resolved;
    ***REMOVED***
        if (requiresRefresh && !requiresRefresh(resolved)) {
            isConstant = true;
            return resolved;
    ***REMOVED***
        if (isExpired(resolved)) {
            await coalesceProvider();
            return resolved;
    ***REMOVED***
        return resolved;
***REMOVED***;
};
exports.memoize = memoize;
