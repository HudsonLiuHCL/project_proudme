'use strict';

const hasDollarKeys = require('./hasDollarKeys');
const { trustedSymbol } = require('./trusted');

module.exports = function sanitizeFilter(filter) {
  if (filter == null || typeof filter !== 'object') {
    return filter;
***REMOVED***
  if (Array.isArray(filter)) {
    for (const subfilter of filter) {
      sanitizeFilter(subfilter);
***REMOVED***
    return filter;
***REMOVED***

  const filterKeys = Object.keys(filter);
  for (const key of filterKeys) {
    const value = filter[key];
    if (value != null && value[trustedSymbol]) {
      continue;
***REMOVED***
    if (key === '$and' || key === '$or') {
      sanitizeFilter(value);
      continue;
***REMOVED***

    if (hasDollarKeys(value)) {
      const keys = Object.keys(value);
      if (keys.length === 1 && keys[0] === '$eq') {
        continue;
  ***REMOVED***
      filter[key] = { $eq: filter[key] };
***REMOVED***
***REMOVED***

  return filter;
};
